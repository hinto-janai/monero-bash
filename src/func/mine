#!/usr/bin/env bash
#
# all-in-one mining functions
# combines multiple functions
# that invoke monerod,xmrig,p2pool
#

mine_Start()
{
	[[ "$MINE_FIRST_TIME" = "true" ]]&& mine_Config
	daemon_Start
	p2pool_Start
	xmrig_Start
}

mine_Stop()
{
	daemon_Stop
	p2pool_Stop
	xmrig_Stop
}

mine_Config()
{
	print_MoneroBashTitle
	$bwhite; printf "DAEMON IP [default - 127.0.0.1]: " ;$off
	read IP
	$bwhite; printf "POOL IP [default - 127.0.0.1:3333]: " ;$off
	read POOL
	$bwhite; printf "WALLET ADDRESS: " ;$off
	read WALLET
	$bblue; printf "DAEMON IP: " ;$off
	if [[ "$IP" = "" ]]; then
		echo "127.0.0.1"
		IP="127.0.0.1"
	else
		echo "$IP"
	fi
	$bblue; printf "POOL IP: " ;$off
	if [[ "$POOL" = "" ]]; then
		echo "127.0.0.1:3333"
		POOL="127.0.0.1:3333"
	else
		echo "$POOL"
	fi
	$bblue; printf "WALLET ADDRESS: " ;$off; echo "$WALLET"
	$bwhite; printf "Use these settings? (Y/n) "
	Yes()
	{
		prompt_Sudo ; error_Sudo
		safety_HashList
		trap "trap_No" 1 2 3 6 15
		export COMMAND="$binP2Pool/p2pool --host $IP --wallet $WALLET"
		systemd_P2Pool
		echo "Editing monero-bash.conf..."
		sudo sed -i "s@.*DAEMON_IP.*@DAEMON_IP=\"$IP\"@" "$config/monero-bash.conf"
		sudo sed -i "s@.*WALLET.*@WALLET=\"$WALLET\"@" "$config/monero-bash.conf"
		echo "Editing xmrig.json..."
		sudo sed -i "s@.*user.*@            \"user\": \"$WALLET\",@" "$config/xmrig.json"
		sudo sed -i "s@.*url.*@            \"url\": \"$POOL\",@" "$config/xmrig.json"
		sudo sed -i "s@.*MINE_FIRST_TIME.*@MINE_FIRST_TIME=\"false\"@" "$state"
		PRODUCE_HASH_LIST
		$bgreen; echo "Mining configuration complete"
	}
	No(){ echo "Exiting..." ;exit;}
	prompt_YESno
}
